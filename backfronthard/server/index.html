<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PROJ1 – Dane na żywo</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background: #121212;
            color: #eee;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            margin-bottom: 15px;
            font-size: 30px;
        }

        #cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 12px;
            width: 200px;
            color: #fff;
            box-shadow: 0 0 15px #0006;
        }

        .value {
            font-size: 36px;
            font-weight: bold;
            margin-top: 10px;
        }

        canvas {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 0 15px #0006;
        }
    </style>
</head>

<body>

<h1>Monitorowanie temperatury i wilgotności</h1>

<div id="cards">
    <div class="card">
        <div>AKTUALNA TEMPERATURA</div>
        <div id="tempBox" class="value">-- °C</div>
    </div>

    <div class="card">
        <div>AKTUALNA WILGOTNOŚĆ</div>
        <div id="humBox" class="value">-- %</div>
    </div>
</div>

<canvas id="chart" width="600" height="300"></canvas>

<script>
    const ctx = document.getElementById("chart").getContext("2d");

    const chart = new Chart(ctx, {
        type: "line",
        data: {
            labels: [],
            datasets: [
                {
                    label: "Temperatura (°C)",
                    borderColor: "orange",
                    data: [],
                },
                {
                    label: "Wilgotność (%)",
                    borderColor: "cyan",
                    data: [],
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    ticks: { color: "#ccc" }
                },
                y: {
                    ticks: { color: "#ccc" }
                }
            }
        }
    });

    async function loadData() {
        const res = await fetch("/api/data");
        const data = await res.json();

        if (data.length > 0) {
            const last = data[data.length - 1];
            document.getElementById("tempBox").textContent =
                last.temp.toFixed(1) + " °C";
            document.getElementById("humBox").textContent =
                last.hum.toFixed(1) + " %";
        }

        chart.data.labels = data.map(x => x.ts);
        chart.data.datasets[0].data = data.map(x => x.temp);
        chart.data.datasets[1].data = data.map(x => x.hum);
        chart.update();
    }

    loadData();
    setInterval(loadData, 5000);   // odświeżanie co 5 sekund
</script>

</body>
</html>
